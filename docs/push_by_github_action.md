# How to Push Your KCL Package by GitHub Action

[kpm](https://github.com/KusionStack/kpm) is a tool for managing kcl packages. This article will guide you how to use kpm in GitHub Action to push your kcl package to OCI registry.

## Step 1: Install kpm

At first, you need to install kpm on your computer. You can follow [kpm installation document](https://kcl-lang.io/docs/user_docs/guides/package-management/installation).

## Step 2: Create a GitHub account

If you already have a GitHub account, you can skip this step.

[Sign up for a new GitHub account](https://docs.github.com/en/get-started/signing-up-for-github/signing-up-for-a-new-github-account)

## Step 3: Create a GitHub repository for your KCL package

### 1. Prepare a GitHub repository for your KCL package

You need to prepare a GitHub repository for your KCL package.

[Create a GitHub repository](https://docs.github.com/en/get-started/quickstart/create-a-repo)

In this repository, add your KCL program, take the repository https://github.com/awesome-kusion/catalog.git as an example,

```bash
├── .github
│   └── workflows
│       └── push.yaml # github action workflow
├── LICENSE
├── README.md
├── kcl.mod # kcl.mod to define your kcl package
├── kcl.mod.lock # kcl.mod.lock generated by kpm
└── main.k # Your KCL program
```

### 2. Set OCI Registry, account and password for your Github repository

#### 2.1 Set OCI Registry and account through GitHub action variables

[Set Variables for Github repository](https://docs.github.com/en/actions/learn-github-actions/variables#creating-configuration-variables-for-a-repository)

Take `docker.io` as an example, you can set two Variables `REG` and `REG_ACCOUNT` for your repository. The value of `REG` is `docker.io`, and the value of `REG_ACCOUNT` is your docker.io account.

#### 2.2 Set your OCI Registry password through GitHub action secrets
[Add secrets for repository](https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository)

Take `docker.io` as an example, you can set your `docker.io` login password as a secrets named `REG_TOKEN`.

If you use `ghcr.io` as `Registry`, you need to use GitHub token as secrets.

[Create a GitHub Token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)

## Step 4: Add your KCL package to the repository and write github action workflow

Add github action file `.github/workflows/push.yml` to this repository, the content is as follows:

```yaml
name: KPM Push Workflow

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Go 1.19
        uses: actions/setup-go@v2
        with:
          go-version: 1.19

      - name: Install kpm
        run: go install kcl-lang.io/kpm@latest

      - name: Login and Push
        env:
          KPM_REG: ${{ vars.REG }}
          KPM_REPO: ${{ vars.REG_ACCOUNT }}
        run: kpm login -u ${{ vars.REG_ACCOUNT }} -p ${{ secrets.REG_TOKEN }} ${{ vars.REG }} && kpm push

      - name: Run kpm project from oci registry
        run: kpm run oci://${{ vars.REG }}/${{ vars.REG_ACCOUNT }}/catalog --tag 0.0.1

```
